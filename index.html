<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Data Pasta</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-left">
                <h1 class="logo-container"><img src="favicon/apple-touch-icon.png" alt="Emoji Data Pasta" class="logo"> Emoji Data Pasta</h1>
            </div>
            <div class="header-right">
                <div class="attribution">
                    <div class="data-source">
                        data from <a href="https://github.com/iamcal/emoji-data/blob/master/emoji.json" target="_blank" rel="noopener noreferrer">iamcal emojidata</a>
                    </div>
                    <div class="creator">
                        created by <a href="https://github.com/alexleybourne" target="_blank" rel="noopener noreferrer">Alex Leybourne</a> 2025
                    </div>
                </div>
                <button id="themeToggle" class="btn btn-small theme-toggle" title="Toggle theme">
                    <span class="theme-icon">🌙</span>
                </button>
            </div>
        </header>

        <div class="toolbar">
            <div class="controls">
                <button id="loadFile" class="btn btn-primary">Load JSON File</button>
                <button id="saveFile" class="btn btn-success">Save Edited Data</button>
                <button id="resetApp" class="btn btn-danger" title="Reset all data and clear saved state">🗑️ Reset</button>
                <span class="separator">|</span>
                <span class="data-info">
                    <span id="totalCount">0 emojis loaded</span>
                </span>
            </div>
            <div class="actions">
                <button id="toggleEmojiTable" class="btn btn-secondary">🔍 Browse Emoji Data</button>
                <button id="selectAll" class="btn btn-secondary">Select All Fields</button>
                <button id="selectNone" class="btn btn-secondary">Select None</button>
                <button id="applyChanges" class="btn btn-warning">Apply Changes</button>
            </div>
        </div>

        <!-- Unified Navigation Header with Emoji Display and Tabs -->
        <div class="navigation-header">
            <!-- Emoji Display Section -->
            <div class="emoji-section">
                <div class="emoji-display" id="emojiDisplay">
                    <div class="emoji-icon" id="emojiIcon">🤔</div>
                    <div class="emoji-info">
                        <div class="emoji-name" id="emojiDisplayName">Select an emoji</div>
                        <div class="emoji-variant-info" id="variantInfo" style="display: none;">
                            <span class="variant-label">Variant:</span>
                            <select id="variantSelect" class="variant-select">
                                <option value="default">Default</option>
                            </select>
                            <button class="btn btn-small" id="resetVariant">🔄</button>
                        </div>
                    </div>
                    <div class="emoji-navigation">
                        <button class="btn btn-small" id="prevEmoji">←</button>
                        <span class="emoji-index" id="emojiIndex">0 / 0</span>
                        <button class="btn btn-small" id="nextEmoji">→</button>
                        <button class="btn btn-small" id="randomEmoji">🎲</button>
                        <button class="btn btn-small" id="quickBrowse" title="Browse Emoji Data">🔍</button>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tools-tabs">
                <button class="tool-tab active" data-tab="field-manager">📊 Fields & Preview</button>
                <button class="tool-tab" data-tab="category-customization">📁 Categories</button>
                <button class="tool-tab" data-tab="search-terms">🏷️ Search Terms</button>
                <button class="tool-tab" data-tab="removed-emojis">🗑️ Removed Emojis</button>
            </div>
        </div>

        <!-- Emoji Browser Modal -->
        <div class="emoji-browser-modal" id="emojiBrowserModal">
            <div class="emoji-browser-content">
                <div class="emoji-browser-header">
                    <h3>🔍 Browse Emoji Data</h3>
                    <div class="search-controls">
                        <input type="text" id="emojiSearch" placeholder="Search emojis (name, category, short_name...)">
                        <span class="search-tip">Showing current output data - click any row to select that emoji</span>
                        <button id="closeEmojiBrowser" class="btn btn-small">×</button>
                    </div>
                </div>
                <div class="emoji-table-container" id="emojiTableContainer">
                    <table class="emoji-table" id="emojiTable">
                        <thead id="emojiTableHead">
                            <tr>
                                <th>Emoji</th>
                                <th>Name</th>
                                <th>Short Name</th>
                                <th>Category</th>
                                <th>Subcategory</th>
                                <th>Unicode</th>
                                <th>Added In</th>
                            </tr>
                        </thead>
                        <tbody id="emojiTableBody">
                        </tbody>
                    </table>
                </div>
                <div class="emoji-browser-footer">
                    <span id="searchResults">0 results</span>
                </div>
            </div>
        </div>

        <!-- Bulk Remove Modal -->
        <div class="bulk-remove-modal" id="bulkRemoveModal">
            <div class="bulk-remove-content">
                <div class="bulk-remove-header">
                    <h3>📝 Bulk Remove Emojis</h3>
                    <button id="closeBulkRemove" class="btn btn-small">×</button>
                </div>
                <div class="bulk-remove-body">
                    <div class="bulk-remove-instructions">
                        <p>Paste raw emoji characters below to automatically find and remove them from your dataset:</p>
                        <div class="example-emojis">
                            <strong>Example:</strong> 🍒🍑🐱🍆🥷💦🔫👅👄
                        </div>
                    </div>
                    
                    <div class="bulk-remove-input-section">
                        <label for="bulkEmojiInput">Raw Emoji Characters:</label>
                        <textarea id="bulkEmojiInput" placeholder="Paste emojis here... 🍒🍑🐱🍆🥷💦🔫👅👄" rows="4"></textarea>
                        <div class="input-stats">
                            <span id="inputEmojiCount">0 emojis detected</span>
                        </div>
                    </div>
                    
                    <div class="bulk-remove-preview" id="bulkRemovePreview" style="display: none;">
                        <h4>Found Emojis to Remove:</h4>
                        <div class="preview-list" id="previewList"></div>
                        <div class="preview-stats">
                            <span id="previewStats">0 emojis will be removed</span>
                        </div>
                    </div>
                </div>
                <div class="bulk-remove-actions">
                    <button id="analyzeEmojis" class="btn btn-primary">🔍 Analyze Emojis</button>
                    <button id="executeBulkRemove" class="btn btn-danger" disabled>➖ Remove Selected</button>
                    <button id="cancelBulkRemove" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Bulk Add Search Terms Modal -->
        <div class="bulk-add-terms-modal" id="bulkAddTermsModal">
            <div class="bulk-add-terms-content">
                <div class="bulk-add-terms-header">
                    <h3>🏷️ Bulk Add Search Terms</h3>
                    <button id="closeBulkAddTerms" class="btn btn-small">×</button>
                </div>
                <div class="bulk-add-terms-body">
                    <div class="current-emoji-context">
                        <div class="current-emoji-display" id="bulkAddCurrentEmoji">
                            <!-- Current emoji info -->
                        </div>
                    </div>
                    
                    <div class="bulk-add-instructions">
                        <p>Add multiple search terms to emojis. Each new line = new emoji:</p>
                        <div class="example-terms">
                            <strong>Format 1 - Emoji + terms:</strong> 💀: dead, ded, skull, death<br>
                            <strong>Format 2 - Short name + terms:</strong> skull: dead, ded, death<br>
                            <strong>Format 3 - Index + terms:</strong> 108: dead, ded, death<br>
                            <strong>Format 4 - Simple terms (current emoji):</strong> word1, word2, word3<br><br>
                            <em>🔍 Tip: Check console for detailed debug info about what was found!</em>
                        </div>
                    </div>
                    
                    <div class="bulk-add-input-section">
                        <label for="bulkTermsInput">Search Terms:</label>
                        <textarea id="bulkTermsInput" placeholder="Each line = new emoji:

💀: dead, ded, skull, death
skull: dead, ded, death  
108: dead, ded, death

Or just terms for current emoji:
word1, word2, word3" rows="6"></textarea>
                        <div class="input-stats">
                            <span id="inputTermsCount">0 terms detected</span>
                        </div>
                    </div>
                    
                    <div class="bulk-add-preview" id="bulkAddPreview" style="display: none;">
                        <h4>Terms to Add:</h4>
                        <div class="terms-preview-list" id="termsPreviewList"></div>
                        <div class="terms-preview-stats">
                            <span id="termsPreviewStats">0 terms will be added</span>
                        </div>
                    </div>
                </div>
                <div class="bulk-add-terms-actions">
                    <button id="analyzeTerms" class="btn btn-primary">🔍 Analyze Terms</button>
                    <button id="executeBulkAddTerms" class="btn btn-success" disabled>🏷️ Add Terms</button>
                    <button id="cancelBulkAddTerms" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Middle Section - Input/Output Split -->
            <div class="json-section">
                <div class="json-panel input-panel">
                    <div class="panel-header">
                        <h2>Original Structure</h2>
                        <span class="sample-info">Current emoji data</span>
                    </div>
                    <div class="json-view" id="originalStructure">
                        <div class="loading">Load a JSON file to see the emoji structure</div>
                    </div>
                </div>

                <div class="panel-divider"></div>

                <div class="json-panel output-panel">
                    <div class="panel-header">
                        <h2>Output Structure</h2>
                        <span class="output-info">How your data will look</span>
                    </div>
                    <div class="json-view" id="outputStructure">
                        <div class="loading">Make field changes to see output preview</div>
                    </div>

                    <div class="json-view" id="tabOriginalStructure">
                        <div class="loading">Load a JSON file to see the emoji structure</div>
                    </div>
                </div>

                <div class="panel-divider"></div>

                <div class="json-panel output-panel">
                    <div class="tool-panel-header">
                        <h2>Output Structure</h2>
                        <span class="output-info">How your data will look</span>
                    </div>
                    <div class="json-view" id="tabOutputStructure">
                        <div class="loading">Make field changes to see output preview</div>
                    </div>

                    <div class="json-view" id="tabOriginalStructure">
                        <div class="loading">Load a JSON file to see the emoji structure</div>
                    </div>
                </div>
            </div>

            <!-- Tabbed Tools Section -->
            <div class="tools-section">
                <div class="tools-content">
                    <!-- Combined Fields & JSON Preview Tab -->
                    <div class="tool-panel active" id="field-manager-tab">
                        <div class="combined-fields-json">
                            <!-- Left side: Field Manager -->
                            <div class="fields-panel">
                                <div class="tool-panel-header">
                                    <h2>Field Manager</h2>
                                    <div class="field-controls">
                                        <div class="preset-controls">
                                            <label for="fieldPresets" class="preset-label">
                                                Field Presets
                                                <div class="preset-info-icon" title="Choose predefined field combinations for different use cases">ℹ</div>
                                            </label>
                                            <div class="preset-actions">
                                                <select id="fieldPresets" class="preset-select">
                                                    <option value="">Select Preset...</option>
                                                    <option value="minimal">Minimal</option>
                                                    <option value="essential">Essential</option>
                                                    <option value="complete">Complete</option>
                                                    <option value="custom">Custom</option>
                                                </select>
                                                <button id="resetPresets" class="btn btn-small" title="Reset to default state">🔄</button>
                                            </div>
                                        </div>
                                        <span class="field-counter" id="fieldCounter">0 fields</span>
                                    </div>
                                </div>
                                <div class="tool-panel-content">
                                    <div class="field-manager" id="fieldManager">
                                        <div class="no-data">Load emoji data to manage fields</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Right side: JSON Preview -->
                            <div class="json-preview-panel">
                                <div class="json-section-in-tab">
                                    <div class="json-panel input-panel">
                                        <div class="tool-panel-header">
                                            <h2>Original Structure</h2>
                                            <span class="sample-info">Current emoji data</span>
                                        </div>
                                        <div class="json-view" id="originalStructure">
                                            <div class="loading">Load a JSON file to see the emoji structure</div>
                                        </div>
                                    </div>

                                    <div class="panel-divider"></div>

                                    <div class="json-panel output-panel">
                                        <div class="tool-panel-header">
                                            <h2>Output Structure</h2>
                                            <span class="output-info">How your data will look</span>
                                        </div>
                                        <div class="json-view" id="outputStructure">
                                            <div class="loading">Make field changes to see output preview</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category Customization Tab -->
                    <div class="tool-panel" id="category-customization-tab">
                        <div class="tool-panel-header">
                            <h2>Category Customization</h2>
                            <div class="category-controls">
                                <div class="category-actions">
                                    <button id="mergeCategoriesBtn" class="btn btn-small btn-primary" disabled title="Merge selected categories">🔗 Merge Selected</button>
                                    <button id="deleteSelectedBtn" class="btn btn-small btn-danger" disabled title="Delete selected categories">🗑️ Delete Selected</button>
                                    <button id="clearSelectionBtn" class="btn btn-small btn-secondary" disabled title="Clear selection">✖️ Clear Selection</button>
                                    <button id="resetCategories" class="btn btn-small btn-secondary" title="Reset to original categories">🔄 Reset All</button>
                                </div>
                                <span class="category-counter" id="categoryCounter">0 categories</span>
                            </div>
                        </div>
                        <div class="tool-panel-content">
                            <div class="category-manager" id="categoryManager">
                                <div class="no-data">Load emoji data to customize categories</div>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Search Terms Tab -->
                    <div class="tool-panel" id="search-terms-tab">
                        <div class="tool-panel-header">
                            <h2>Custom Search Terms</h2>
                            <div class="search-terms-controls">
                                <div class="search-terms-actions">
                                    <button id="addSearchTerm" class="btn btn-small btn-primary" title="Add custom search term to current emoji">🏷️ Add Term</button>
                                    <button id="bulkAddTerms" class="btn btn-small btn-primary" title="Add multiple terms at once">📝 Bulk Add</button>
                                    <button id="clearCustomTerms" class="btn btn-small btn-secondary" title="Clear all custom terms for current emoji">🗑️ Clear Terms</button>
                                    <button id="resetAllCustomTerms" class="btn btn-small btn-danger" title="Reset all custom search terms">🔄 Reset All</button>
                                </div>
                                <span class="search-terms-counter" id="searchTermsCounter">0 custom terms</span>
                            </div>
                        </div>
                        <div class="tool-panel-content">
                            <div class="search-terms-manager" id="searchTermsManager">
                                <div class="no-data">Load emoji data to add custom search terms</div>
                            </div>
                        </div>
                    </div>

                    <!-- Removed Emojis Tab -->
                    <div class="tool-panel" id="removed-emojis-tab">
                        <div class="tool-panel-header">
                            <h2>Removed Emojis</h2>
                            <div class="removed-controls">
                                <button id="addRemovedEmoji" class="btn btn-small btn-warning" title="Add current emoji to removed list">➖ Remove Current</button>
                                <button id="bulkRemoveEmojis" class="btn btn-small btn-danger" title="Bulk remove emojis by pasting raw emoji characters">📝 Bulk Remove</button>
                                <button id="clearRemovedEmojis" class="btn btn-small btn-secondary" title="Restore all removed emojis">🔄 Clear All</button>
                                <span class="removed-counter" id="removedCounter">0 removed</span>
                            </div>
                        </div>
                        <div class="tool-panel-content">
                            <div class="removed-manager" id="removedManager">
                                <div class="no-data">No emojis removed</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h3>Export Settings</h3>
                <button id="closeSettings" class="btn btn-small">×</button>
            </div>
            <div class="settings-content">
                <div class="file-size-comparison" id="fileSizeComparison" style="display: none;">
                    <h4>File Size Impact</h4>
                    <div class="size-stats">
                        <div class="size-stat">
                            <span class="size-label">Original Size:</span>
                            <span class="size-value" id="originalSize">-</span>
                        </div>
                        <div class="size-stat">
                            <span class="size-label">New Size:</span>
                            <span class="size-value" id="newSize">-</span>
                        </div>
                        <div class="size-stat savings">
                            <span class="size-label">Space Saved:</span>
                            <span class="size-value" id="spaceSaved">-</span>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="saveSettings" checked>
                        <strong>Save Settings</strong>
                    </label>
                    <div class="setting-description">
                        When enabled, your field selections and export preferences will be saved in the file. 
                        When you reload this file later, it will automatically restore your previous configuration 
                        and show you exactly what was changed from the original data.
                    </div>
                </div>

                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="includeEmptyFields" checked>
                        <strong>Include Empty Fields</strong>
                    </label>
                    <div class="setting-description">
                        Keep fields that have null, empty string, or undefined values in the output. 
                        Unchecking this will remove these fields entirely, making the file smaller.
                    </div>
                </div>

                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="prettifyJson" checked>
                        <strong>Pretty Format JSON</strong>
                    </label>
                    <div class="setting-description">
                        Format the JSON with proper indentation and line breaks for human readability. 
                        Unchecking this creates a minified single-line file that's smaller but harder to read.
                    </div>
                </div>

                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="includeStats" checked>
                        <strong>Include Processing Statistics</strong>
                    </label>
                    <div class="setting-description">
                        Add metadata about the processing operation including how many fields were removed, 
                        processing timestamp, and other useful information for tracking changes.
                    </div>
                </div>

                <div class="setting-group">
                    <label for="filename"><strong>Output Filename:</strong></label>
                    <input type="text" id="filename" value="emoji-edited.json">
                    <div class="setting-description">
                        The name of the downloaded file. Include .json extension for proper file type recognition.
                    </div>
                </div>

                <div class="settings-actions">
                    <button id="downloadFile" class="btn btn-success">
                        <span class="btn-icon">⬇️</span>
                        Download File
                    </button>
                    <button id="cancelExport" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Progress Modal -->
        <div class="progress-modal" id="progressModal">
            <div class="progress-content">
                <h3>Processing Emojis...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0 / 0 emojis processed</div>
            </div>
        </div>

        <!-- Tooltip -->
        <div class="tooltip" id="tooltip"></div>

        <!-- Custom Search Term Modal -->
        <div class="search-term-modal" id="searchTermModal">
            <div class="search-term-content">
                <div class="search-term-header">
                    <h3>Add Custom Search Term</h3>
                    <button class="btn btn-small" onclick="emojiPasta.hideSearchTermModal()">✕</button>
                </div>
                <div class="search-term-body">
                    <div class="search-term-emoji-info" id="searchTermEmojiInfo">
                        <div class="search-term-emoji-icon">📝</div>
                        <div class="search-term-emoji-name">Loading...</div>
                    </div>
                    <div class="search-term-input-group">
                        <label for="searchTermInput">Enter search term:</label>
                        <input type="text" id="searchTermInput" placeholder="e.g., happy, smile, joy" maxlength="50">
                    </div>
                    <div class="search-term-actions">
                        <button class="btn btn-secondary" onclick="emojiPasta.hideSearchTermModal()">Cancel</button>
                        <button class="btn btn-primary" onclick="emojiPasta.confirmAddSearchTerm()">Add Term</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div class="confirm-modal" id="confirmModal">
            <div class="confirm-content">
                <div class="confirm-header">
                    <h3 id="confirmTitle">Confirm Action</h3>
                </div>
                <div class="confirm-body">
                    <div class="confirm-message" id="confirmMessage">Are you sure?</div>
                    <div class="confirm-actions">
                        <button class="btn btn-secondary" onclick="emojiPasta.hideConfirmModal()">Cancel</button>
                        <button class="btn btn-danger" id="confirmButton" onclick="emojiPasta.confirmAction()">Confirm</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Modal -->
        <div id="loadingModal" class="loading-modal">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <div class="loading-text" id="loadingText">Loading...</div>
            </div>
        </div>

        <!-- Changes Summary Modal -->
        <div id="changesSummaryModal" class="changes-summary-modal">
            <div class="modal-content changes-summary-content">
                <div class="modal-header">
                    <h3>📋 Changes Applied</h3>
                    <button class="close-btn" id="closeChangesSummary">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="changes-summary">
                        <div class="changes-intro">
                            <p>Successfully applied your customizations to the current emoji dataset:</p>
                        </div>
                        <div class="changes-stats" id="changesStats">
                            <!-- Stats will be populated dynamically -->
                        </div>
                        <div class="changes-details" id="changesDetails">
                            <!-- Details will be populated dynamically -->
                        </div>
                        <div class="changes-footer">
                            <p><strong>✨ Your customizations have been applied to the latest emoji data!</strong></p>
                            <p>Any new emojis from the base dataset are preserved, and your custom changes are layered on top.</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="confirmChanges">Got it!</button>
                </div>
            </div>
        </div>

        <!-- Reset Confirmation Modal -->
        <div id="resetConfirmModal" class="reset-confirm-modal">
            <div class="modal-content reset-confirm-content">
                <div class="modal-header">
                    <h3>⚠️ Reset Application</h3>
                    <button class="close-btn" id="closeResetConfirm">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="reset-warning">
                        <div class="warning-icon">🔄</div>
                        <div class="warning-text">
                            <p><strong>This will reset the tool to use the default emoji data.</strong></p>
                            <p>All your current customizations will be lost, including:</p>
                            <ul>
                                <li>🔧 Field selections and presets</li>
                                <li>❌ Removed emojis</li>
                                <li>📁 Category mappings</li>
                                <li>🏷️ Custom search terms</li>
                                <li>⚙️ All settings and preferences</li>
                            </ul>
                            <div class="save-recommendation">
                                <p><strong>💡 We recommend saving your edited data first!</strong></p>
                                <p>Use the "Save Edited Data" button to download your current work before resetting.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelReset">Cancel</button>
                    <button class="btn btn-warning" id="saveFirst">Save First, Then Reset</button>
                    <button class="btn btn-danger" id="confirmReset">I'm Sure - Reset Now</button>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" accept=".json" style="display: none;">
    
    <script src="script.js"></script>
</body>
</html> 